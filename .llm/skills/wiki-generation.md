# Wiki Generation

This skill covers best practices for GitHub Wiki generation and maintenance in this repository.

---

## Overview

The repository uses automated GitHub Actions workflows to generate and deploy wiki content from the `docs/` folder. **All wiki generation logic is implemented in testable Python scripts** rather than embedded in YAML. See [github-actions-script-pattern](./github-actions-script-pattern.md) for the rationale.

### Wiki Generation Scripts

Located in `scripts/wiki/`:

| Script                     | Purpose                                     |
| -------------------------- | ------------------------------------------- |
| `prepare_wiki.py`          | Main orchestration: copy, rename, transform |
| `transform_wiki_links.py`  | Convert relative links to wiki page refs    |
| `generate_wiki_sidebar.py` | Generate wiki sidebar from wiki files       |
| `generate_wiki_footer.py`  | Generate wiki footer                        |
| `test_wiki_scripts.py`     | Comprehensive tests (50+ test cases)        |

### Running Wiki Tests

```bash
# Run bash wiki generation tests (fast, validates syntax patterns)
bash scripts/tests/test-wiki-generation.sh

# Activate virtual environment for Python tests
source .venv/bin/activate

# Run all wiki Python tests (comprehensive, 50+ test cases)
python -m pytest scripts/wiki/test_wiki_scripts.py -v

# Test on actual repository
python scripts/wiki/prepare_wiki.py \
  --source . --dest /tmp/test-wiki --verbose
```

**Both test suites MUST pass.** The bash tests validate that the Python scripts use correct Markdown link syntax. The Python tests validate the actual logic of link transformations, sidebar generation, etc.

### Pre-Push Hook Integration

The pre-push hook automatically runs wiki tests when wiki-related files change:

- `scripts/wiki/*.py` ‚Äî Python wiki scripts
- `scripts/tests/test-wiki-generation.sh` ‚Äî Bash validation tests
- `.github/workflows/deploy-wiki.yml` ‚Äî Wiki deployment workflow

If you modify any of these files, the pre-push hook will run both bash and Python wiki tests automatically.

---

## Key Concepts

### Link Syntax: Markdown vs MediaWiki

GitHub Wiki supports two link syntaxes, but **only one works correctly when pages are Markdown**:

| Syntax Type | Format                   | Use When              |
| ----------- | ------------------------ | --------------------- |
| Markdown    | `[Display Text](Page)`   | ‚úÖ Pages are Markdown |
| MediaWiki   | `[[Page\|Display Text]]` | ‚ùå Never for Markdown |

**CRITICAL**: Always use standard **Markdown link syntax** `[Display](Page)` for wiki sidebar and page links. The MediaWiki wikilink syntax `[[Page|Display]]` does NOT render correctly when wiki pages are Markdown files.

### Why This Matters

GitHub Wiki renders links based on the page format:

- **Markdown pages** (`.md` files): Use `[text](link)` syntax
- **MediaWiki pages**: Use `[[link|text]]` syntax

Our wiki pages are all Markdown (`.md`), so all links must use Markdown syntax.

---

## Wiki Page Naming Convention

Documentation files are transformed into wiki page names:

```text
Source: docs/overview/getting-started.md
Wiki:   Overview-Getting-Started.md
```

**Rules:**

1. Replace `/` with `-`
2. Remove `.md` extension
3. Capitalize first letter of each segment

**Examples:**

<!-- markdownlint-disable MD013 -->

```text
Source File                              Wiki Page Name
docs/overview/index.md                   Overview-Index.md
docs/features/inspector/buttons.md       Features-Inspector-Buttons.md
docs/guides/odin-migration-guide.md      Guides-Odin-Migration-Guide.md
```

<!-- markdownlint-enable MD013 -->

---

## Sidebar Generation

The wiki sidebar file is generated by `scripts/wiki/generate_wiki_sidebar.py`.
The workflow calls this Python script directly instead of embedding bash logic.

### Correct Format

```markdown
## üìö Documentation

### Getting Started

- [Home](Home)
- [Getting Started](Overview-Getting-Started)
- [Glossary](Overview-Glossary)

### Features

- [Inspector Overview](Features-Inspector-Overview)
```

### Incorrect Format (DO NOT USE)

```markdown
## üìö Documentation

### Getting Started

- [[Home]]
- [[Overview-Getting-Started|Getting Started]]
```

The MediaWiki format above will render incorrectly‚Äîshowing the page name as
display text and corrupting the link target.

---

## Validation

The `deploy-wiki.yml` workflow includes validation to catch broken sidebar links:

<!-- markdownlint-disable MD013 -->

```bash
# Extracts [Display](Page) links and verifies each page exists
# Character class includes: letters, numbers, hyphens, underscores, periods
missing_pages=$(grep -oE '\]\([A-Za-z0-9_.-]+\)' _Sidebar.md | \
  sed 's/\](//;s/)//' | sort -u | while read -r page; do
  [ ! -f "$page.md" ] && echo "$page"
done || true)
```

<!-- markdownlint-enable MD013 -->

---

## Page Name Characters

**Valid Characters**: Page names should contain only:

- Letters (A-Z, a-z)
- Numbers (0-9)
- Hyphens (-)
- Underscores (\_)

Avoid spaces and other special characters.

---

## Troubleshooting

### Symptom: Sidebar links show page name instead of display text

**Cause**: Using MediaWiki wikilink syntax `[[Page|Display]]` instead of
Markdown syntax `[Display](Page)`

**Fix**: Convert all sidebar links to Markdown format:

```bash
# Before (broken)
echo "- [[Overview-Getting-Started|Getting Started]]"

# After (correct)
echo "- [Getting Started](Overview-Getting-Started)"
```

### Symptom: Links point to wrong pages

**Cause**: Wiki page naming doesn't match the generated filename

**Fix**: Verify page naming follows the conversion rules:

1. File path segments become hyphen-separated
2. Each segment is capitalized
3. `.md` extension is stripped in links

### Symptom: Sidebar validation passes but links are broken

**Cause**: Validation regex doesn't match the link format being used

**Fix**: Ensure validation regex matches the actual link format:

- For `[Display](Page)`: Use `\]\([A-Za-z0-9_.-]+\)`
- For `[[Page|Display]]`: Use `\[\[[A-Za-z0-9_.-]+` (deprecated)

---

## Testing

**TWO test suites validate wiki generation:**

### Bash Tests (`scripts/tests/test-wiki-generation.sh`)

Fast syntax validation tests that verify:

- Python scripts use Markdown link syntax (not MediaWiki)
- `get_display_name()` function produces correct display names
- Sidebar links are generated in `[Display](Page)` format
- No MediaWiki `[[Page|Display]]` syntax is present

```bash
# Run bash tests (fast, ~2 seconds)
bash scripts/tests/test-wiki-generation.sh
```

### Python Tests (`scripts/wiki/test_wiki_scripts.py`)

Comprehensive unit and integration tests (50+ test cases):

```bash
# Create and activate virtual environment (one time)
python3 -m venv .venv
source .venv/bin/activate
pip install pytest

# Run all wiki Python tests
python -m pytest scripts/wiki/test_wiki_scripts.py -v

# Test specific module
python -m pytest \
  scripts/wiki/test_wiki_scripts.py::TestTransformPathToWikiPage -v

# Test on actual repository
python scripts/wiki/prepare_wiki.py \
  --source . --dest /tmp/test-wiki --verbose
```

Tests cover:

- Link transformation (`transform_path_to_wiki_page`, `transform_wiki_links`)
- Image path normalization (`transform_image_paths`)
- Sidebar generation (`generate_sidebar`)
- Footer generation (`generate_footer`)
- Wiki page naming (`path_to_wiki_name`)
- Full pipeline integration (`prepare_wiki`)
- Edge cases (empty content, malformed links, external URLs)

### When Tests Run

| Trigger            | Bash Tests | Python Tests             |
| ------------------ | ---------- | ------------------------ |
| Pre-push hook      | ‚úÖ         | ‚úÖ (if pytest installed) |
| CI (PR/push)       | ‚úÖ         | ‚úÖ                       |
| Manual (`npm run`) | ‚úÖ         | ‚úÖ                       |

---

## Related Files

<!-- markdownlint-disable MD013 -->

| File                                        | Purpose                         |
| ------------------------------------------- | ------------------------------- |
| `.github/workflows/deploy-wiki.yml`         | Main wiki deployment workflow   |
| `.github/workflows/validate-wiki-links.yml` | PR link validation + wiki tests |
| `scripts/wiki/prepare_wiki.py`              | Main wiki preparation script    |
| `scripts/wiki/transform_wiki_links.py`      | Link transformation logic       |
| `scripts/wiki/generate_wiki_sidebar.py`     | Sidebar generation              |
| `scripts/wiki/generate_wiki_footer.py`      | Footer generation               |
| `scripts/wiki/test_wiki_scripts.py`         | Python test suite (50+ tests)   |
| `scripts/tests/test-wiki-generation.sh`     | Bash syntax validation tests    |
| `.githooks/pre-push`                        | Pre-push hook (runs wiki tests) |
| `docs/`                                     | Source documentation files      |

<!-- markdownlint-enable MD013 -->

---

## Critical Rules

### Test Synchronization (CRITICAL)

When refactoring wiki generation scripts (e.g., moving from inline bash to Python):

1. **Update BOTH test suites** ‚Äî Bash tests (`test-wiki-generation.sh`)
   AND Python tests (`test_wiki_scripts.py`)
2. **Bash tests validate Python scripts** ‚Äî The bash tests grep Python
   files for correct patterns
3. **Run both locally before pushing** ‚Äî Pre-push hook runs both, but
   manual verification is faster

**Example failure scenario (what caused this issue):**

- Wiki generation was refactored from inline bash in `deploy-wiki.yml`
  to Python scripts
- Python tests were updated, but bash tests still checked for old
  inline bash patterns
- CI failed because bash tests looked for `echo "- [Home](Home)"`
  which no longer existed
- Fix: Updated bash tests to check Python scripts for correct
  Markdown link patterns

### Comment and Documentation Synchronization (CRITICAL)

When modifying wiki generation scripts, **update comments that reference
implementation details**:

1. **Remove dead code** ‚Äî Delete unused functions entirely; don't leave
   them "for future use"
2. **Update implementation references** ‚Äî If code moves from bash/Perl
   to Python, update comments
3. **Keep docstrings current** ‚Äî Ensure module and function docstrings
   reflect actual behavior

**Common mistakes**:

- Leaving comments like "Perl-based transformation" when Python is now used
- Keeping helper functions that were part of a refactor but never integrated
- Docstrings describing an old algorithm after a rewrite

---

## Related Skills

<!-- markdownlint-disable MD013 -->

- [github-actions-script-pattern](./github-actions-script-pattern.md) ‚Äî Why we use scripts not embedded YAML
- [update-documentation](./update-documentation.md) ‚Äî Documentation standards
- [validate-before-commit](./validate-before-commit.md) ‚Äî Pre-commit checks
- [github-pages](./github-pages.md) ‚Äî GitHub Pages deployment (separate from wiki)

<!-- markdownlint-enable MD013 -->
